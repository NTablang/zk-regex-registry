const { generateEmailVerifierInputs } = require("@zk-email/helpers");

export async function generateCircuitInputs(rawEmail) {
    const circuitInputs = await generateEmailVerifierInputs(rawEmail, {
        ignoreBodyHashCheck: false,
        maxBodyLength: 4032,
        shaPrecomputeSelector: "<%- shaPrecomputeSelector %>",
    });

    const emailBodyString = Buffer.from(circuitInputs.emailBody.map(Number)).toString('ascii');
    let regexInputs = {};
    <% values.forEach(function(value) { %>
    const match = emailBodyString.match(new RegExp("<%- value.prefixRegex %>"))
    if (match && match.index) {
        regexInputs = {
            ...regexInputs,
            <%- value.name %>RegexIdx: match.index + match[0].length
        }
    }
    <% }) %>

    return {
        ...circuitInputs,
        ...regexInputs,
    }
}